<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>KARAT — Вход</title>

<style>
body{font-family:Arial;background:#f6f6f6;padding:20px;text-align:center}
input{padding:12px;font-size:18px;width:80%;max-width:300px;margin-bottom:15px;border-radius:8px;border:1px solid #888}
button{padding:12px 20px;font-size:18px;border-radius:8px;border:none;background:#333;color:#fff;cursor:pointer}
button:hover{background:#555}
.error{margin-top:15px;color:red;font-weight:bold}
</style>
</head>

<body>

<h2>Вход</h2>

<input id="phone" type="tel" placeholder="Введите номер телефона">
<br>
<button onclick="login()">Войти</button>
<div class="error" id="error"></div>

<script>
const API = "https://script.google.com/macros/s/AKfycbydYQAoOMHlIAEZIsSUu3sNALYsltItXaBrc6qYHkUdmRvbfgIAutkhgV1Yowpw46WmFg/exec";

async function login() {
  const phone = document.getElementById("phone").value.trim();
  const errorBox = document.getElementById("error");
  errorBox.innerText = "";

  if (!phone) {
    errorBox.innerText = "Введите номер";
    return;
  }

  try {
    const res = await fetch(`${API}?login=1&phone=${encodeURIComponent(phone)}`);
    const data = await res.json();
    console.log("LOGIN RAW:", data);

    if (!data || data.found !== true) {
      errorBox.innerText = "Неверный номер";
      return;
    }

    // ЖЁСТКАЯ НОРМАЛИЗАЦИЯ
    const auth = {
      role: data.role === "admin" || data.admin === true ? "admin" : "coach",
      trainer_id: data.trainer_id || data.id || "",
      name: data.name || data.FIO || data.fio || "Без имени"
    };

    localStorage.setItem("auth", JSON.stringify(auth));

    window.location.href = auth.role === "admin"
      ? "admin_menu.html"
      : "index.html";

  } catch (e) {
    console.error(e);
    errorBox.innerText = "Ошибка соединения";
  }
}
</script>

</body>
</html>
